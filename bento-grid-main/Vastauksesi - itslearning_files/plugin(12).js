CKEDITOR.plugins.add("oembed",TextEditorManager.setupIframePlugin("oembed",{dialogName:"oembed_dialog",useBuiltInCloseButton:!0,emptyIframeOnClose:!0,dialogSrcReplacementFunction:function(e,t){return t.DialogSrc.replace("{editorId}",e.name)},dialogContentLoad:function(e,t,n){var d,o=e.getSelection();if(!0===e.EditEmbedMode&&o&&null!=o.getSelectedElement()){d=o.getSelectedElement().getAttribute("editReference");var i=n[0]&&n[0].contentWindow||n.contentWindow;CommonFunctions.makePostMessageCall(i,new CommonWindowMessages.GenericMessageWithData(CommonWindowMessages.MessageNames.editEmbededContent,{editReference:d}))}e.EditEmbedMode=!1},beforeInitComplete:function(e,t){e.contextMenu&&(e.addMenuGroup("oembed"),e.addMenuItem("oembed",{label:t.EditText,command:t.Id,group:"oembed"}),e.contextMenu.addListener(function(t,n){var d=n?n.getSelectedElement():t;if((d&&(d=d.getAscendant("img",!0)),d&&!d.isReadOnly()&&!d.data("cke-realelement")&&null!=d.getAttribute("id")&&0==d.getAttribute("id").indexOf("extension:"))&&TextEditorManager.getExtensionIdFromIdString(d.getAttribute("id"))==TextEditorManager.commonSettings.constants.oembedExtensionId)return e.EditEmbedMode=!0,{oembed:CKEDITOR.TRISTATE_OFF};return null}))}}));