"use strict";function imatheq_sendKpiMeasurement(e,t){if(e.ExtraSettings.KpiUrl)try{var a=e.ExtraSettings.KpiUrl;a=(a=(a=a.replace("kpiMeasureSection",e.ExtraSettings.MeasureSection)).replace("kpiMeasurement",t)).replace("kpiMeasureContext",1),fetch(a,{method:"GET",credentials:"include",mode:"cors"})}catch(e){}}function imatheq_parseMessageData(e){if(e&&e.data){if("string"!=typeof e.data)return e.data;try{return JSON.parse(e.data)}catch(t){return e.data}}return null}CKEDITOR.plugins.add("imatheq",TextEditorManager.setupIframePlugin("imatheq",{dialogName:"imatheq_dialog",useBuiltInCloseButton:!0,emptyIframeOnClose:!0,dialogContentLoad:function(e,t,a){var n,i,r=e.getSelection();r&&null!=r.getSelectedElement()&&(i=r.getSelectedElement().getAttribute("data-mathml"),n=r.getSelectedElement().getId(),(a[0]&&a[0].contentWindow||a.contentWindow).postMessage(JSON.stringify({messageName:"editimatheqcontent",mathml:i,imageid:n}),"*"))},beforeInitComplete:function(e,t){e.contextMenu&&(e.addMenuGroup("imatheq"),e.addMenuItem("imatheq",{label:t.EditText,command:t.Id,group:"imatheq"}),e.contextMenu.addListener(function(e,t){var a=t?t.getSelectedElement():e;return a&&(a=a.getAscendant("img",!0)),!a||a.isReadOnly()||a.data("cke-realelement")||null==a.getAttribute("data-mathml")?null:{imatheq:CKEDITOR.TRISTATE_OFF}}),window.addEventListener("message",function(e){var a=imatheq_parseMessageData(e);a&&"textEditorInteraction"===a.messageName&&"imatheq"===a.plugin&&imatheq_sendKpiMeasurement(t,a.isNew?t.ExtraSettings.MeasurementAdd:t.ExtraSettings.MeasurementEdit)}))}}));