CKEDITOR.plugins.add("editltideeplinkingimage",{init:function(editor){var config=editor.config,extensionConfig=editor.config.editltideeplinkingimage,pluginName=extensionConfig.Id,dataToEdit=null;function postDataToEdit(e,t){setTimeout(function(){e?CommonFunctions.attachPostMessageEventListener($(window),CommonWindowMessages.MessageNames.popupIsLoaded,function(){CommonFunctions.makePostMessageCallWithData(e,new CCL.CommonWindowMessages.GenericMessage(CommonWindowMessages.MessageNames.textEditorInteraction),{dataToEdit:t?t.outerHTML:""})}):postDataToEdit(e,t)},100)}editor.addCommand(pluginName,{exec:function(e){var windowPopup=eval(extensionConfig.Command);postDataToEdit(windowPopup,dataToEdit)}}),editor.contextMenu&&(editor.addMenuGroup("ltideeplinking"),editor.addMenuItem("editltideeplinkingimage",{label:extensionConfig.Text,icon:extensionConfig.IconSrc||this.path+"icons/tools"+(CKEDITOR.env.hidpi?"32.png":"16.png"),command:pluginName,group:"ltideeplinking"}),editor.contextMenu.addListener(function(e){if(e){var t=e.getElementsByTag("img");e=t.getItem(0)}if(e&&e.data("type")&&"lti-1p0:contentitem:image"==e.data("type")&&null!=e.getAttribute("id")&&0==e.getAttribute("id").indexOf("extension:")){var n=TextEditorManager.getExtensionIdFromIdString(e.getAttribute("id"));return extensionConfig.Command=extensionConfig.Command.replace("{editorId}",editor.name),extensionConfig.Command=extensionConfig.Command.replace(new RegExp(/ExtensionId=\S*?&/),"ExtensionId="+n+"&"),extensionConfig.Command=extensionConfig.Command.replace(new RegExp(/EditMode=\S*?&/),"EditMode=true&"),(dataToEdit=new Image).src=e.getAttribute("src"),dataToEdit.alt=e.getAttribute("alt"),{editltideeplinkingimage:CKEDITOR.TRISTATE_OFF}}return null}))}});