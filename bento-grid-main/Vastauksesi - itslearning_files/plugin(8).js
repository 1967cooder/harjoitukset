CKEDITOR.plugins.add("editextension",{init:function(editor){var config=editor.config,extensionConfig=editor.config.editextension,pluginName=extensionConfig.Id;editor.addCommand(pluginName,{exec:function(e){eval(extensionConfig.Command)}}),editor.contextMenu&&(editor.addMenuGroup("extension"),editor.addMenuItem("editextension",{label:extensionConfig.Text,icon:extensionConfig.IconSrc||this.path+"icons/tools"+(CKEDITOR.env.hidpi?"32.png":"16.png"),command:pluginName,group:"extension"}),editor.contextMenu.addListener(function(e){if(e&&(e=e.getAscendant("img",!0)),e&&!e.isReadOnly()&&!e.data("cke-realelement")&&!e.data("type")&&null!=e.getAttribute("id")&&0==e.getAttribute("id").indexOf("extension:")){var n=TextEditorManager.getExtensionIdFromIdString(e.getAttribute("id"));if(n==TextEditorManager.commonSettings.constants.oembedExtensionId)return null;var t=e.getAttribute("editReference"),i=null!=t&&t.length>0;return editor.getMenuItem("editextension").label=i?extensionConfig.EditText:extensionConfig.Text,extensionConfig.Command=extensionConfig.Command.replace("{editorId}",editor.name),extensionConfig.Command=extensionConfig.Command.replace(new RegExp(/ExtensionId=\S*?&/),"ExtensionId="+n+"&"),extensionConfig.Command=extensionConfig.Command.setQueryStringParameter("EditReference",t),{editextension:CKEDITOR.TRISTATE_OFF}}return null}))}});