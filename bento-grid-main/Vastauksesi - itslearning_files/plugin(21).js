/**
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
"use strict";!function(){var e='<img alt="" src="" />',t=new CKEDITOR.template('<figure class="{captionedClass}">'+e+"<figcaption>{captionPlaceholder}</figcaption></figure>"),i={left:0,center:1,right:2},a=/^\s*(\d+\%)\s*$/i;function n(e){var t=r(e),i=e.config.image2_captionedClass;return function(e,n){var s,r=e.name;if(!e.attributes["data-cke-realelement"]&&!(e.attributes.plugincontent||e.attributes.mediacontent||e.attributes["data-mathml"]||e.attributes["data-tex"]||e.attributes["data-slideshow-settings"])){var o=e.attributes.src;if(!o||!(o.indexOf("/ui/controls/editor/FCK/editor/images/smiley/")>=0||o.indexOf("/controls/editor/plugins/smiley/images/")>=0)){if(t(e)){if("div"==r){var g=e.getFirst("figure");g&&(e.replaceWith(g),e=g)}n.align="center",s=e.getFirst("img")||e.getFirst("a").getFirst("img")}else"figure"==r&&e.hasClass(i)?s=e.find(function(e){return"img"===e.name&&-1!==CKEDITOR.tools.array.indexOf(["figure","a"],e.parent.name)},!0)[0]:l(e)&&(s="a"==e.name?e.children[0]:e);if(s){for(var c in{width:1,height:1}){var d=s.attributes[c];d&&d.match(a)&&delete s.attributes[c]}return e}}}}}function s(e){var t=e.config.image2_alignClasses;return function(e){var a="a"==e.name?e.getFirst():e,n=a.attributes,s=this.data.align;if(!this.inline){var r=e.getFirst("span");r&&r.replaceWith(r.getFirst({img:1,a:1}))}if(s&&"none"!=s){var l=CKEDITOR.tools.parseCssText(n.style||"");"center"==s&&"figure"==e.name?e=e.wrapWith(new CKEDITOR.htmlParser.element("div",t?{class:t[1]}:{style:"text-align:center"})):s in{left:1,right:1}&&(t?a.addClass(t[i[s]]):(l.float=s,"img"==e.name&&(l.margin="left"==s?"0 5px 0 0":"0 0 0 5px"))),t||CKEDITOR.tools.isEmpty(l)||(n.style=CKEDITOR.tools.writeCssText(l))}return e}}function r(e){var t=e.config.image2_captionedClass,i=e.config.image2_alignClasses,a={figure:1,a:1,img:1};return function(n){if(!(n.name in{div:1,p:1}))return!1;var s=n.children;if(1!==s.length)return!1;var r=s[0];if(!(r.name in a))return!1;if("p"==n.name){if(!l(r))return!1}else if("figure"==r.name){if(!r.hasClass(t))return!1}else{if(e.enterMode==CKEDITOR.ENTER_P)return!1;if(!l(r))return!1}return!!(i?n.hasClass(i[1]):"center"==CKEDITOR.tools.parseCssText(n.attributes.style||"",!0)["text-align"])}}function l(e){return"img"==e.name||"a"==e.name&&(1==e.children.length&&e.getFirst("img"))}function o(e){var t=e.widgets.focused;return t&&"image"==t.name?t:null}function g(e){var t=e.config.image2_alignClasses,i={div:{match:r(e)},p:{match:r(e)},img:{attributes:"!src,alt,width,height"},figure:{classes:"!"+e.config.image2_captionedClass},figcaption:!0};return t?(i.div.classes=t[1],i.p.classes=i.div.classes,i.img.classes=t[0]+","+t[2],i.figure.classes+=","+i.img.classes):(i.div.styles="text-align",i.p.styles="text-align",i.img.styles="float",i.figure.styles="float,display"),i}function c(e){var t=e.config.image2_alignClasses;return{dimension:{requiredContent:"img[width,height]"},align:{requiredContent:"img"+(t?"("+t[0]+")":"{float}")},caption:{requiredContent:"figcaption"}}}function d(e){return e.data.hasCaption?e.element:e.parts.image}CKEDITOR.plugins.add("image2",{lang:"ca,co,da,de,en,en-gb,en-us,es,fi,fr,it,lt,nb,nl,nn-no,pl,pt-br,ru,sv,tr,uk,zh-cn",requires:"widget,dialog",icons:"image",hidpi:!0,onLoad:function(){CKEDITOR.addCss('.cke_image_nocaption{line-height:0}.cke_editable.cke_image_sw, .cke_editable.cke_image_sw *{cursor:sw-resize !important}.cke_editable.cke_image_se, .cke_editable.cke_image_se *{cursor:se-resize !important}.cke_image_resizer{display:none;position:absolute;width:10px;height:10px;bottom:-5px;right:-5px;background:#000;outline:1px solid transparentline-height:0;cursor:se-resize;}.cke_image_resizer_wrapper{position:relative;display:inline-block;line-height:0;}.cke_image_resizer.cke_image_resizer_left{right:auto;left:-5px;}.cke_image_resizer.cke_image_resizer_top{bottom:auto;top:-5px;}.cke_image_resizer.cke_image_resizer_top.cke_image_resizer.cke_image_resizer_right,.cke_image_resizer.cke_image_resizer_bottom.cke_image_resizer.cke_image_resizer_left{cursor:sw-resize;}.cke_widget_wrapper:hover .cke_image_resizer,.cke_image_resizer.cke_image_resizing{display:block}.cke_editable[contenteditable="false"] .cke_image_resizer{display:none;}.cke_widget_wrapper>a{display:inline-block}')},init:function(t){if(!t.plugins.detectConflict("image2",["easyimage"])){var a=t.config,r=t.lang.image2,l=function(t){var a=t.config.image2_alignClasses,r=t.config.image2_captionedClass;function l(){this.deflated||(t.widgets.focused==this.widget&&(this.focused=!0),t.widgets.destroy(this.widget),this.deflated=!0)}function o(){var e=t.editable(),n=t.document;if(this.deflated){if(this.widget=t.widgets.initOn(this.element,"image",this.widget.data),this.widget.inline&&!new CKEDITOR.dom.elementPath(this.widget.wrapper,e).block){var s=n.createElement(t.activeEnterMode==CKEDITOR.ENTER_P?"p":"div");s.replace(this.widget.wrapper),this.widget.wrapper.move(s)}this.focused&&(this.widget.focus(),delete this.focused),delete this.deflated}else!function(e,t){var a=e.wrapper,n=e.data.align,s=e.data.hasCaption;if(t){for(var r=3;r--;)a.removeClass(t[r]);"center"==n?s&&a.addClass(t[1]):"none"!=n&&a.addClass(t[i[n]])}else"center"==n?(s?a.setStyle("text-align","center"):a.removeStyle("text-align"),a.removeStyle("float"),a.removeStyle("margin")):("none"==n?(a.removeStyle("float"),a.removeStyle("margin")):(a.setStyle("float",n),s||a.setStyle("margin","left"==n?"0 5px 0 0":"0 0 0 5px")),a.removeStyle("text-align"))}(this.widget,a)}return{allowedContent:g(t),requiredContent:"img[src,alt]",features:c(t),styleableElements:"img figure",contentTransformations:[["img[width]: sizeToAttribute"]],editables:{caption:{selector:"figcaption",allowedContent:"br em strong sub sup u s; a[*]"}},parts:{image:"img",caption:"figcaption"},dialog:"image2",template:e,data:function(){var e=this.features;if(this.data.hasCaption&&!t.filter.checkFeature(e.caption)&&(this.data.hasCaption=!1),"none"==this.data.align||t.filter.checkFeature(e.align)||(this.data.align="none"),this.shiftState({widget:this,element:this.element,oldData:this.oldData,newData:this.data,deflate:l,inflate:o}),this.data.link?this.parts.link||(this.parts.link=this.parts.image.getParent()):this.parts.link&&delete this.parts.link,this.parts.image.setAttributes({src:this.data.src,"data-cke-saved-src":this.data.src,alt:this.data.alt}),this.oldData&&!this.oldData.hasCaption&&this.data.hasCaption)for(var i in this.data.classes)this.parts.image.removeClass(i);t.filter.checkFeature(e.dimension)&&function(e){var t=e.data,i={width:t.width,height:t.height},a=e.parts.image;for(var n in i)i[n]?a.setAttribute(n,i[n]):a.removeAttribute(n)}(this),this.oldData=CKEDITOR.tools.extend({},this.data)},init:function(){var e=CKEDITOR.plugins.image2,n=this.parts.image,s={hasCaption:!!this.parts.caption,src:n.getAttribute("src"),alt:n.getAttribute("alt")||"",width:n.getAttribute("width")||"",height:n.getAttribute("height")||"",lock:!this.ready||e.checkHasNaturalRatio(n)},r=n.getAscendant("a");if(r&&this.wrapper.contains(r)&&(this.parts.link=r),!s.align){var l=s.hasCaption?this.element:n;a?(l.hasClass(a[0])?s.align="left":l.hasClass(a[2])&&(s.align="right"),s.align?l.removeClass(a[i[s.align]]):s.align="none"):(s.align=l.getStyle("float")||"none",l.removeStyle("float"),l.removeStyle("margin"))}if(t.plugins.link&&this.parts.link){s.link=e.getLinkAttributesParser()(t,this.parts.link);var o=s.link.advanced;o&&o.advCSSClasses&&(o.advCSSClasses=CKEDITOR.tools.trim(o.advCSSClasses.replace(/cke_\S+/,"")))}this.wrapper[(s.hasCaption?"remove":"add")+"Class"]("cke_image_nocaption"),this.setData(s),t.filter.checkFeature(this.features.dimension)&&!0!==t.config.image2_disableResizer&&function(e){function t(e){var t=n.createElement("span");return t.setAttribute("title",i.lang.image2.resizer),t.append(new CKEDITOR.dom.text("â€‹",n)),t.addClass("cke_image_resizer"),e.forEach(function(e){t.addClass(e)}),t}var i=e.editor,a=i.editable(),n=i.document,s=e.resizer=t(["cke_image_resizer_bottom","cke_image_resizer_right"]),r=t(["cke_image_resizer_bottom","cke_image_resizer_left"]),l=t(["cke_image_resizer_top","cke_image_resizer_left"]),o=t(["cke_image_resizer_top","cke_image_resizer_right"]);if(e.inline)e.wrapper.append(l),e.wrapper.append(o),e.wrapper.append(r),e.wrapper.append(s);else{var g=e.parts.link||e.parts.image,c=g.getParent(),d=n.createElement("span");d.addClass("cke_image_resizer_wrapper"),d.append(g),d.append(l),d.append(o),d.append(r),d.append(s),e.element.append(d,!0),c.is("span")&&c.remove()}var m=function(t){var g,c,d,m,h,u,f,p=t.data.$.target.classList.contains("cke_image_resizer_top"),_=t.data.$.target.classList.contains("cke_image_resizer_left"),v=e.parts.image,C={width:15,height:15},k=x(),w=_?-1:1,T=t.data.$.screenX,b=t.data.$.screenY,E=v.$.clientWidth,D=v.$.clientHeight,I=E/D,O=[],R="cke_image_s"+(p^_?"w":"e");function y(e,t,i){var a=CKEDITOR.document,s=[];if(n.equals(a)||s.push(a.on(e,t)),s.push(n.on(e,t)),i)for(var r=s.length;r--;)i.push(s.pop())}function S(){c=E+w*h,d=Math.round(c/I)}function z(){d=D-u,c=Math.round(d*I)}function A(e){g=e.data.$,h=g.screenX-T,u=b-g.screenY,f=Math.abs(h/u),p?0==h?z():S():1==w?h<=0?u<=0||f>=I?S():z():u<=0?f>=I?z():S():z():h<=0?u<=0?f>=I?z():S():z():u<=0||f>=I?S():z(),F(c,d)&&(m={width:c,height:d},v.setAttributes(m))}function K(){for(var t;t=O.pop();)t.removeListener();a.removeClass(R),l.removeClass("cke_image_resizing"),o.removeClass("cke_image_resizing"),r.removeClass("cke_image_resizing"),s.removeClass("cke_image_resizing"),m&&(e.setData(m),i.fire("saveSnapshot")),m=!1}function x(){var e,t=i.config.image2_maxSize;return t?(t=CKEDITOR.tools.copy(t),e=CKEDITOR.plugins.image2.getNatural(v),t.width=Math.max("natural"===t.width?e.width:t.width,C.width),t.height=Math.max("natural"===t.height?e.height:t.height,C.width),t):null}function F(e,t){var i=e<C.width||t<C.height,a=k&&(e>k.width||t>k.height);return!i&&!a}i.fire("saveSnapshot"),y("mousemove",A,O),y("mouseup",K,O),a.addClass(R),t.data.$.target.classList.add("cke_image_resizing")};l.on("mousedown",m),o.on("mousedown",m),r.on("mousedown",m),s.on("mousedown",m)}(this),this.shiftState=e.stateShifter(this.editor),this.on("contextMenu",function(e){var t;(e.data.image=CKEDITOR.TRISTATE_OFF,this.parts.link||(t=this.wrapper.getAscendant("a")))&&(!!this.parts.link&&this.parts.link.hasAttribute("data-link-id")||!!t&&!!t.getAttribute("data-link-id")||(e.data.link=CKEDITOR.TRISTATE_OFF),e.data.unlink=CKEDITOR.TRISTATE_OFF)})},addClass:function(e){d(this).addClass(e)},hasClass:function(e){return d(this).hasClass(e)},removeClass:function(e){d(this).removeClass(e)},getClasses:(m=new RegExp("^("+[].concat(r,a).join("|")+")$"),function(){var e=this.repository.parseElementClasses(d(this).getAttribute("class"));for(var t in e)m.test(t)&&delete e[t];return e}),upcast:n(t),downcast:s(t),getLabel:function(){var e=(this.data.alt||"")+" "+this.pathName;return this.editor.lang.widget.label.replace(/%1/,e)}};var m}(t);a.filebrowserImage2BrowseUrl=a.filebrowserImageBrowseUrl,a.filebrowserImage2UploadUrl=a.filebrowserImageUploadUrl,l.pathName=r.pathName,l.editables.caption.pathName=r.pathNameCaption,t.widgets.add("image",l),t.ui.addButton&&t.ui.addButton("Image",{label:t.lang.common.image,command:"image",toolbar:"insert,10"}),t.contextMenu&&(t.addMenuGroup("image",10),t.addMenuItem("image",{label:r.menu,command:"image",group:"image"})),CKEDITOR.dialog.add("image2",this.path+"dialogs/image2.js")}},afterInit:function(e){var t=function(e){var t,i=[];return function(a){var n=e.getCommand("justify"+a);n&&(i.push(function(){n.refresh(e,e.elementPath())}),a in{right:1,left:1,center:1}&&n.on("exec",function(t){var n=o(e);if(n){n.setData("align",a);for(var s=i.length;s--;)i[s]();t.cancel()}}),n.on("refresh",function(i){var n=o(e),s={right:1,left:1,center:1};n&&(void 0===t&&(t=e.filter.checkFeature(e.widgets.registered.image.features.align)),t?this.setState(n.data.align==a?CKEDITOR.TRISTATE_ON:a in s?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED):this.setState(CKEDITOR.TRISTATE_DISABLED),i.cancel())}))}}(e);for(var i in{left:1,right:1,center:1,block:1})t(i);!function(e){if(!e.plugins.link)return;var t=CKEDITOR.on("dialogDefinition",function(t){var i=t.data;if("link"==i.name){var a=i.definition,n=a.onShow,s=a.onOk;a.onShow=function(){var t=o(e),i=this.getContentElement("info","linkDisplayText").getElement().getParent().getParent();!t||t.inline&&t.wrapper.getAscendant("a")?(i.show(),n.apply(this,arguments)):(this.setupContent(t.data.link||{}),i.hide())},a.onOk=function(){var t=o(e);if(!t||t.inline&&t.wrapper.getAscendant("a"))s.apply(this,arguments);else{var i={};this.commitContent(i),t.setData("link",i)}}}});e.on("destroy",function(){t.removeListener()}),e.getCommand("unlink").on("exec",function(t){var i=o(e);i&&i.parts.link&&(i.setData("link",null),this.refresh(e,e.elementPath()),t.cancel())}),e.getCommand("unlink").on("refresh",function(t){var i=o(e);i&&(this.setState(i.data.link||i.wrapper.getAscendant("a")?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),t.cancel())})}(e)}}),CKEDITOR.plugins.image2={stateShifter:function(e){var i=e.document,a=e.config.image2_alignClasses,n=e.config.image2_captionedClass,s=e.editable(),r=["hasCaption","align","link"],l={align:function(t,i,n){var s,r,l=t.element;t.changed.align?t.newData.hasCaption||("center"==n&&(t.deflate(),t.element=o(e,l)),t.changed.hasCaption||"center"!=i||"center"==n||(t.deflate(),t.element=((r=(s=l).findOne("a,img")).replace(s),r))):"center"==n&&t.changed.hasCaption&&!t.newData.hasCaption&&(t.deflate(),t.element=o(e,l)),!a&&l.is("figure")&&("center"==n?l.setStyle("display","inline-block"):l.removeStyle("display"))},hasCaption:function(a,s,r){var l;if(a.changed.hasCaption)if(l=a.element.is({img:1,a:1})?a.element:a.element.findOne("a,img"),a.deflate(),r){var o=CKEDITOR.dom.element.createFromHtml(t.output({captionedClass:n,captionPlaceholder:e.lang.image2.captionPlaceholder}),i);g(o,a.element),l.replace(o.findOne("img")),a.element=o}else l.replace(a.element),a.element=l},link:function(t,a,n){if(t.changed.link){var s,r=t.element.is("img")?t.element:t.element.findOne("img"),l=t.element.is("a")?t.element:t.element.findOne("a"),o=t.element.is("a")&&!n||t.element.is("img")&&n;if(o&&t.deflate(),n){a||(s=function(e,t){var a=i.createElement("a",{attributes:{href:t.url}});return a.replace(e),e.move(a),a}(r,t.newData.link));var g=CKEDITOR.plugins.image2.getLinkAttributesGetter()(e,n);CKEDITOR.tools.isEmpty(g.set)||(s||l).setAttributes(g.set),g.removed.length&&(s||l).removeAttributes(g.removed)}else s=function(e){var t=e.findOne("img");return t.replace(e),t}(l);o&&(t.element=s)}}};function o(e,t){var n={};a?n.attributes={class:a[1]}:n.styles={"text-align":"center"};var s=i.createElement(e.activeEnterMode==CKEDITOR.ENTER_P?"p":"div",n),r=t,l=t.getParent();return l&&"A"===l.$.nodeName&&(r=l),g(s,r),r.move(s),s}function g(t,i){if(i.getParent()){var a=e.createRange();a.moveToPosition(i,CKEDITOR.POSITION_BEFORE_START),i.remove(),s.insertElementIntoRange(t,a)}else t.replace(i)}return function(e){var t,i;for(e.changed={},i=0;i<r.length;i++)t=r[i],e.changed[t]=!!e.oldData&&e.oldData[t]!==e.newData[t];for(i=0;i<r.length;i++)l[t=r[i]](e,e.oldData?e.oldData[t]:null,e.newData[t]);e.inflate&&e.inflate()}},checkHasNaturalRatio:function(e){var t=e.$,i=this.getNatural(e);return Math.round(t.clientWidth/i.width*i.height)==t.clientHeight||Math.round(t.clientHeight/i.height*i.width)==t.clientWidth},getNatural:function(e){var t;if(e.$.naturalWidth)t={width:e.$.naturalWidth,height:e.$.naturalHeight};else{var i=new Image;i.src=e.getAttribute("src"),t={width:i.width,height:i.height}}return t},getLinkAttributesGetter:function(){return CKEDITOR.plugins.link.getLinkAttributes},getLinkAttributesParser:function(){return CKEDITOR.plugins.link.parseLinkAttributes}}}(),CKEDITOR.config.image2_captionedClass="image";