function LearningObjectiveList(e){window[e]=this;var n,t,i=this;return i.text=null,i.learningObjectives=null,i.insertRequestProcessed=!1,i.toggeled=!1,i.editMode=ko.observable(!1),i.isAssessmentReportLinkVisible=ko.observable(!1),i.isAddLoButtonVisible=ko.observable(!1),i.canDelete=ko.observable(!1),i.saveChangesImmediately=ko.observable(!1),i.getLoCountAsString=function(){var e=i.getLearningObjectiveCount();return 0===e?i.settings.text.noLearningObjectives:1===e?String.format(i.settings.text.oneLearningObjective,1):String.format(i.settings.text.severalLearningObjectives,e)},i.showMoreClick=function(e){e.expanded(!e.expanded())},i.toggleDescription=function(e){n.learningObjectives.forEach(function(n){n.descriptionIsShown(n==e&&!n.descriptionIsShown())})},i.deleteClick=function(e){i.saveChangesImmediately()?i.deleteLearningObjectiveImmediately(e):i.deleteLearningObjective(e,null,!1)},i.initialize=function(){n=i.settings,t=i.controls,i.text=n.text,i.applySettings(n),i.saveChangesImmediately(i.settings.saveChangesImmediately),n.learningObjectives.forEach(function(e){i.extendListItem(e)}),i.learningObjectives=ko.observableArray(n.learningObjectives),$(function(){ko.cleanNode($(t.container)[0]),ko.applyBindings(i,$(t.container)[0])})},i.applySettings=function(e){i.editMode(e.editMode),i.isAssessmentReportLinkVisible(e.isAssessmentReportLinkVisible),i.isAddLoButtonVisible(e.isAddLoButtonVisible),i.canDelete(i.settings.allowDelete&&i.editMode())},i.extendListItem=function(e){return e.expanded=ko.observable(!0),e.showMoreLinkVisible=ko.observable(!1),e.descriptionIsShown=ko.observable(!1),e.showMoreText=ko.pureComputed(function(){return this.expanded()?i.settings.text.showLess:i.settings.text.showMore},e),e.DeleteTitle=String.format(i.settings.text.deleteX,e.Title),e},i.extendListItems=function(e){return e.forEach(function(e){i.extendListItem(e)}),e},i.toggleItems=function(){i.toggeled||(ko.utils.arrayForEach(i.learningObjectives(),function(e){i.toggleItem(e)}),i.toggeled=!0)},i.toggleItem=function(e){var n=$("[item-id="+e.Id+"]");n.height()>parseFloat(n.css("line-height"))*i.settings.maximumNumberOfLinesToShowForDescription&&(e.showMoreLinkVisible(!0),e.expanded(!1))},i.setOptionSaveChangesImmediately=function(e){i.saveChangesImmediately(e)},i.closeContextDialog=function(){$(".ccl-context-dialog-close").click()},i.insertLearningObjectives=function(e){var n=[];e.forEach(function(e){n.push(parseInt(e))}),setTimeout(function(){i.insertRequestProcessed||window[i.settings.learningObjectivesSelectorClientInstanceName].showProgressFeedback()},1e3);var t=i.getInsertedLearningObjectives(n);i.saveChangesImmediately()?i.addNewLearningObjectivesImmediately(t):i.addNewLearningObjectives(t)},i.openSelectorDialog=function(){var e=window[i.settings.learningObjectivesSelectorClientInstanceName];e.selectedIds=i.getLearningObjectiveIds(),e.openDialog()},i.getInsertedLearningObjectives=function(e){var n=i.getLearningObjectiveIds();return e.filter(function(e){return n.indexOf(e)<0})},i.getLearningObjectiveIds=function(){var e=[];return ko.utils.arrayForEach(i.learningObjectives(),function(n){e.push(n.Id)}),e},i.getLearningObjectives=function(){var e=[];return ko.utils.arrayForEach(i.learningObjectives(),function(n){e.push(n)}),e},i.restoreLearningObjectives=function(e){i.needRestoreLearningObjectives(e)&&(i.learningObjectives.removeAll(),ko.utils.arrayPushAll(i.learningObjectives,e),i.setSelectedLearningObjectives())},i.needRestoreLearningObjectives=function(e){var n=i.learningObjectives(),t=!0;if(e.length!==n.length)return!0;for(var s=0;s<e.length;s++)if(e[s].Id!==n[s].Id){t=!1;break}return!t},i.toggleNewAddedItems=function(e){for(var n=i.getLearningObjectiveCount(),t=n-e;t<n;t++)i.toggleItem(i.learningObjectives()[t]);i.toggeled=!0},i.setSelectedLearningObjectives=function(){var e=[];i.getLearningObjectiveIds().forEach(function(n){e.push(n.toString())}),window[i.settings.learningObjectivesSelectorClientInstanceName].setSelectedIds(e,!0)},i.getLearningObjectiveCount=function(){return i.learningObjectives().length},i.addNewLearningObjectivesImmediately=function(e){$.ajax({type:"POST",url:i.settings.addLearningObjectivesToElementServiceUrl,data:$.param({elementId:i.settings.elementId,courseId:i.settings.courseId,learningObjectiveIds:e,returnUrl:i.settings.returnUrl},!0),dataType:"json",success:function(e){i.finishAddingLearningObjectives(e.learningObjectives,e.maxScore,!1)},error:function(e){CCL.CommonFunctions.alertAjaxError(e)}})},i.addNewLearningObjectives=function(e,n){CCL.CommonFunctions.safeAjaxPost({url:i.settings.getLearningObjectivesServiceUrl.replace("{elementId}",i.settings.elementId),data:{courseId:i.settings.courseId,learningObjectiveIds:e,returnUrl:i.settings.returnUrl}}).done(function(e){i.finishAddingLearningObjectives(e.learningObjectives,null,n)}).fail(function(e){CCL.CommonFunctions.alertAjaxError(e)})},i.finishAddingLearningObjectives=function(e,n,t){ko.utils.arrayPushAll(i.learningObjectives,i.extendListItems(e)),i.toggeled=!1,i.insertRequestProcessed=!0,$(document).trigger(i.settings.eventSelectionSavedJsName),$(document).trigger(i.settings.eventListChangeName,{ids:i.getLearningObjectiveIds(),maxScore:n,isSyncContext:t}),window[i.settings.learningObjectivesSelectorClientInstanceName].showSuccessFeedback(),i.setSelectedLearningObjectives()},i.deleteLearningObjectiveImmediately=function(e){$.ajax({type:"POST",url:i.settings.deleteLearningObjectivesFromElementServiceUrl,data:$.param({elementId:i.settings.elementId,courseId:i.settings.courseId,learningObjectiveIds:[e.Id]},!0),dataType:"json",success:function(n){i.deleteLearningObjective(e,n.maxScore,!1)},error:function(e){CCL.CommonFunctions.alertAjaxError(e)}})},i.deleteLearningObjective=function(e,n,t){i.learningObjectives.remove(e),$(document).trigger(i.settings.eventListChangeName,{ids:i.getLearningObjectiveIds(),maxScore:n,isSyncContext:t}),i.setSelectedLearningObjectives()},i.syncLearningObjectives=function(e){var n=[];n=n.concat(e);var t=[];t=t.concat(i.learningObjectives()),e&&0!==e.length?(t.forEach(function(t){e.includes(t.Id)?n.splice(n.indexOf(t.Id),1):i.deleteLearningObjective(t,null,!0)}),n.length>0&&i.addNewLearningObjectives(n,!0)):t.forEach(function(e){i.deleteLearningObjective(e,null,!0)})},i}