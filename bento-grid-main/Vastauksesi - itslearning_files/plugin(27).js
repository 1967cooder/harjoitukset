/**
 * @license Copyright (c) 2003-2020, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
!function(){"use strict";var e={_attachScript:function(e,t){var n=new CKEDITOR.dom.element("script");return n.setAttribute("src",e),n.on("error",t),CKEDITOR.document.getBody().append(n),n},sendRequest:function(e,t,n,a){var i={};t=t||{};var s,o=CKEDITOR.tools.getNextNumber();function r(){s&&(s.remove(),delete CKEDITOR._.jsonpCallbacks[o],s=null)}return t.callback="CKEDITOR._.jsonpCallbacks["+o+"]",CKEDITOR._.jsonpCallbacks[o]=function(e){setTimeout(function(){r(),n(e)})},s=this._attachScript(e.output(t),function(){r(),a&&a()}),i.cancel=r,i}};CKEDITOR.plugins.add("embedbase",{lang:"ca,co,da,de,en,en-gb,en-us,es,fi,fr,it,lt,nb,nl,nn-no,pl,pt-br,ru,sv,tr,uk,zh-cn",requires:"dialog,widget,notificationaggregator",onLoad:function(){CKEDITOR._.jsonpCallbacks={}},init:function(){CKEDITOR.dialog.add("embedBase",this.path+"dialogs/embedbase.js")}}),CKEDITOR.plugins.embedBase={createWidgetBaseDefinition:function(t){var n,a=t.lang.embedbase;return{mask:!0,template:"<div></div>",pathName:a.pathName,_cache:{},urlRegExp:/^((https?:)?\/\/|www\.)/i,init:function(){this.on("sendRequest",function(e){this._sendRequest(e.data)},this,null,999),this.on("handleResponse",function(e){if(!e.data.html){var t=this._responseToHtml(e.data.url,e.data.response);null!==t?e.data.html=t:(e.data.errorMessage="unsupportedUrl",e.cancel())}},this,null,999)},loadContent:function(e,t){t=t||{};var n=this,a=this._getCachedResponse(e),i={noNotifications:t.noNotifications,url:e,callback:s,errorCallback:function(e){n._handleError(i,e),t.errorCallback&&t.errorCallback(e)}};if(!a)return t.noNotifications||(i.task=this._createTask()),this.fire("sendRequest",i),i;function s(a){if(i.response=a,!n.editor.widgets.instances[n.id])return CKEDITOR.warn("embedbase-widget-invalid"),void(i.task&&i.task.done());n._handleResponse(i)&&(n._cacheResponse(e,a),t.callback&&t.callback())}setTimeout(function(){s(a)})},isUrlValid:function(e){return this.urlRegExp.test(e)&&!1!==this.fire("validateUrl",e)},getErrorMessage:function(e,n,a){var i=t.lang.embedbase[e+(a||"")];return i||(i=e),new CKEDITOR.template(i).output({url:n||""})},_sendRequest:function(t){var n=this,a=e.sendRequest(this.providerUrl,{url:encodeURIComponent(t.url)},t.callback,function(){t.errorCallback("fetchingFailed")});t.cancel=function(){a.cancel(),n.fire("requestCanceled",t)}},_handleResponse:function(e){var t={url:e.url,html:"",response:e.response};return!1!==this.fire("handleResponse",t)?(e.task&&e.task.done(),this._setContent(e.url,t.html),!0):(e.errorCallback(t.errorMessage),!1)},_handleError:function(e,n){e.task&&(e.task.cancel(),e.noNotifications||t.showNotification(this.getErrorMessage(n,e.url),"warning"))},_responseToHtml:function(e,t){return"photo"==t.type?'<img src="'+CKEDITOR.tools.htmlEncodeAttr(t.url)+'" alt="'+CKEDITOR.tools.htmlEncodeAttr(t.title||"")+'" style="max-width:100%;height:auto" />':"video"==t.type||"rich"==t.type?(t.html=t.html.replace(/<iframe/g,'<iframe tabindex="-1"'),t.html):null},_setContent:function(e,t){this.setData("url",e),this.element.setHtml(t)},_createTask:function(){return n&&!n.isFinished()||(n=new CKEDITOR.plugins.notificationAggregator(t,a.fetchingMany,a.fetchingOne)).on("finished",function(){n.notification.hide()}),n.createTask()},_cacheResponse:function(e,t){this._cache[e]=t},_getCachedResponse:function(e){return this._cache[e]}}},_jsonp:e}}();