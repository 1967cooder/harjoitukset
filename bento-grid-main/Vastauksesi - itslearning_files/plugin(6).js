CKEDITOR.plugins.add("previewmedia",TextEditorManager.setupIframePlugin("previewmedia",{addToolBarButton:!1,dialogName:"previewmedia_dialog",dialogSrcReplacementFunction:function(e,t,a){var n=t.ExtraSettings,l=a.getSelection(),i=t.DialogSrc;if(l&&null!=l.getSelectedElement()){var d=document.createElement("template");d.innerHTML=decodeURIComponent(l.getSelectedElement().data("cke-realelement"));var r=JSON.parse(d.content.firstChild.getAttribute(n.mediaContentAttribute));[{key:"{filePath}",value:r.url},{key:"{fileName}",value:r.fileName},{key:"{playerMediaType}",value:r.mediaType},{key:"{fallbackUrl}",value:r.fallbackUrl}].forEach(function(e){i=(i=i.replace(e.key,encodeURIComponent(e.value))).replace(new RegExp(encodeURIComponent(e.key),"i"),encodeURIComponent(encodeURIComponent(e.value)))})}return i},beforeInitComplete:function(e,t){e.contextMenu&&(e.addMenuGroup("previewmedia"),e.addMenuItem("previewmedia",{label:t.EditText,command:t.Id,group:"previewmedia"}),e.contextMenu.addListener(function(e,a){var n=a?a.getSelectedElement():e;return n&&(n=n.getAscendant("img",!0)),n&&!n.isReadOnly()&&n.data("cke-realelement")&&(n.hasClass(t.ExtraSettings.cssClasses.fakeVideo)||n.hasClass(t.ExtraSettings.cssClasses.fakeAudio))?{previewmedia:CKEDITOR.TRISTATE_OFF}:null}))}}));