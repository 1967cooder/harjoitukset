"use strict";function latexplugin_sendKpiMeasurement(e,t){if(e.ExtraSettings.KpiUrl)try{var n=e.ExtraSettings.KpiUrl;n=(n=(n=n.replace("kpiMeasureSection",e.ExtraSettings.MeasureSection)).replace("kpiMeasurement",t)).replace("kpiMeasureContext",1),fetch(n,{method:"GET",credentials:"include",mode:"cors"})}catch(e){}}function latexplugin_parseMessageData(e){if(e&&e.data){if("string"!=typeof e.data)return e.data;try{return JSON.parse(e.data)}catch(t){return e.data}}return null}CKEDITOR.plugins.add("latexplugin",TextEditorManager.setupIframePlugin("latexplugin",{dialogName:"latexplugin_dialog",useBuiltInCloseButton:!0,emptyIframeOnClose:!0,dialogContentLoad:function(e,t,n){var a,i,l=e.getSelection();l&&null!=l.getSelectedElement()&&(i=l.getSelectedElement().getAttribute("data-tex"),a=l.getSelectedElement().getId(),(n[0]&&n[0].contentWindow||n.contentWindow).postMessage(JSON.stringify({messageName:"editlatexplugincontent",tex:i,imageid:a}),"*"))},beforeInitComplete:function(e,t){e.contextMenu&&(e.addMenuGroup("latexplugin"),e.addMenuItem("latexplugin",{label:t.EditText,command:t.Id,group:"latexplugin"}),e.contextMenu.addListener(function(e,t){var n=t?t.getSelectedElement():e;return n&&(n=n.getAscendant("img",!0)),!n||n.isReadOnly()||n.data("cke-realelement")||null==n.getAttribute("data-tex")?null:(t.selectElement(n),{latexplugin:CKEDITOR.TRISTATE_OFF})}),window.addEventListener("message",function(e){var n=latexplugin_parseMessageData(e);n&&"textEditorInteraction"===n.messageName&&"latexplugin"===n.plugin&&latexplugin_sendKpiMeasurement(t,n.isNew?t.ExtraSettings.MeasurementAdd:t.ExtraSettings.MeasurementEdit)}))}}));