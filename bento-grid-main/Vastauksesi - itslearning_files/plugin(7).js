"use strict";function isBrowseExtensions(e){return void 0===e.isBrowseExtensions&&(e.isBrowseExtensions=e.DialogSrc&&-1!=e.DialogSrc.toLowerCase().indexOf("browseextensions.aspx")),e.isBrowseExtensions}function sortByText(e,t){if("function"==typeof e)return 1;if("function"==typeof t)return-1;if(isBrowseExtensions(e))return 1;if(isBrowseExtensions(t))return-1;var n=e.Text.toLowerCase(),i=t.Text.toLowerCase();return n<i?-1:n>i?1:0}CKEDITOR.plugins.add("itslpluginlist",{requires:["iframedialog"],update:function(e,t){var n=new Event("rebuildList");e.element.$.dispatchEvent(n)},init:function(editor){var globalConfig=editor.config,path=this.path,specificConfig=globalConfig.itslpluginlist,menuitems=[],plugincommand;let counter=0;var menuGroup="plugins_group";editor.addMenuGroup(menuGroup);var menuButton=new CKEDITOR.ui.menuButton({label:specificConfig.LabelText,title:specificConfig.TitleText,toolbar:"insert,10",onMenu:function(){if(Object.keys(menuitems).length>1)return menuitems;var e=Object.keys(menuitems)[0];if("itslbrowseextensions"!=e)return menuitems;editor.ui.instances.itslpluginlist._.menu.hide(),e&&openIFrame(e)},modes:{wysiwyg:1}});editor.ui.add("itslpluginlist",CKEDITOR.UI_MENUBUTTON,menuButton);var rebuildList=CKEDITOR.tools.bind(function(e,t){toggleMenuButtonLoadingState(!0),fetch(specificConfig.DataSrc).then(function(e){return e.json()}).then(function(e){menuitems=getMenuItems(e),t&&openIFrame("plugin"+t),toggleMenuButtonLoadingState(!1)})},!0);function getMenuItems(e){var t=[];if(e&&e.length){e.sort(sortByText);for(var n=0;n<e.length;n++){var i=e[n];editor.addCommand(i.Id,{exec:function(){openIFrame(this.name)}}),t[i.Id.toLowerCase()]={id:i.Id,label:i.Text,group:menuGroup,icon:i.IconSrc,order:n+1,command:i.Id,dataItem:i}}editor.addMenuItems(t)}return t}function toggleMenuButtonLoadingState(e){var t=editor.ui.instances.itslpluginlist;if(t){var n=document.querySelectorAll(".cke_button__itslpluginlist_icon");n.forEach(function(e){e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="0 0"}),e?(n.forEach(function(e){e.style.backgroundImage="url("+path+"icons/itsl-plugin-list-toolbar-loader-16.gif)"}),t.setState(CKEDITOR.TRISTATE_DISABLED)):(n.forEach(function(e){e.style.backgroundImage="url("+path+"icons/itsl-plugin-list-toolbar-button-16.png)"}),t.setState(CKEDITOR.TRISTATE_OFF))}}editor.element.$.addEventListener("rebuildList",rebuildList),editor.on("menuShow",function(e){var t=document.getElementById(e.data[0].element.$.id);t.style.maxHeight="170px";var n=t.getElementsByTagName("iframe")[0].contentDocument,i=n.querySelector("html");i.style.overflow="auto",i.style.overflowX="hidden",n.querySelectorAll(".cke_panel_block").forEach(function(e){e.style.outline="none"}),n.querySelectorAll(".cke_menuitem span").forEach(function(e){e.style.cursor="pointer"}),n.querySelectorAll(".cke_menubutton_icon").forEach(function(e){e.style.backgroundColor="transparent"}),n.querySelectorAll(".cke_menubutton_label").forEach(function(e){e.style.textOverflow="ellipsis",e.style.whiteSpace="nowrap",e.style.display="inline-block",e.style.paddingBottom="5px",e.style.maxWidth="150px",e.style.overflowX="hidden"})});var onContentLoadBrowseExtensions=function(){},onContentLoad=TextEditorManager.getOnContentLoadFunctionForIframeDialog(),openIFrame=function(id){var editorMenuItem=editor.getMenuItem(id);if(editorMenuItem){var item=editorMenuItem.dataItem,customDialogDefinition={onShow:function(){var e=CKEDITOR.dialog.getCurrent(),t=e._.element;e.parts.close.hide(),e.parts.footer.hide(),e.parts.title.hide(),"1"==item.IsEditorDialogTransparent&&t.addClass("hiddenDialog");var n=e._.editor.getCommand("maximize"),i=t.getChild(0).$;if(n&&n.state==CKEDITOR.TRISTATE_ON?i.style.width=item.DialogWidth+"px":i.style.width&&(i.style.width=""),null!=navigator.userAgent.match(/iPad/i)){if("function"==typeof FrameCollapser){var o=new FrameCollapser;o.initialize(),o.collapseFrames(),CKEDITOR.dialog.getCurrent().on("hide",function(e){o.expandFrames()})}var r=CKEDITOR.document.getWindow();function a(){var e=r.getViewPaneSize(),t=document.querySelector(".cke_dialog_background_cover");0==orientation||180==orientation?(t.style.width=e.width+"px",t.style.height=e.height+"px"):(t.style.width=e.height+"px",t.style.height=e.width+"px")}a(),top.window.onorientationchange=a}},onHide:()=>CKEDITOR.dialog.getCurrent()._.element.$.getElementsByTagName("iframe").src=""};if(item.Command&&item.Command.length>0)CKEDITOR.instances[editor.name].focus(),item.Command=item.Command.replace("{editorId}",editor.name),eval(item.Command);else{const e=id+counter++;CKEDITOR.dialog.addIframe(e,"",item.DialogSrc,item.DialogWidth,item.DialogHeight,isBrowseExtensions(item)?onContentLoadBrowseExtensions:onContentLoad,customDialogDefinition),plugincommand=editor.addCommand(e,new CKEDITOR.dialogCommand(e)),plugincommand.exec()}}}}}),CKEDITOR.on("instanceReady",function(e){var t=e.editor,n=new Event("rebuildList");t.element.$.dispatchEvent(n)});